version: 0.2

# Test Stage - Runs Jest tests and coverage reports
# This stage focuses solely on testing the application

phases:
  install:
    runtime-versions:
      nodejs: 18
  
  pre_build:
    commands:
      - echo "ğŸ§ª Starting Test Stage..."
      - echo "Node.js version:"
      - node --version
      - echo "NPM version:"
      - npm --version
      - echo "Checking package.json and package-lock.json..."
      - ls -la package*.json
      - echo "Installing dependencies..."
      - npm ci --verbose
  
  build:
    commands:
      - echo "ğŸ” Running Jest tests..."
      - npm test
      - echo "ğŸ“Š Generating test coverage report..."
      - npm run test:coverage
  
  post_build:
    commands:
      - echo "âœ… All tests passed successfully!"
      - echo "ğŸ“ˆ Test coverage report generated"

reports:
  jest_reports:
    files:
      - coverage/lcov.info
    file-format: 'CLOVERXML'
    base-directory: 'coverage'

cache:
  paths:
    - 'node_modules/**/*'